<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart IoT Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{--card-bg:rgba(255,255,255,0.08);--accent1:#ff512f;--accent2:#00c6ff}
    body{margin:0;font-family:Segoe UI,system-ui,Arial;background:linear-gradient(270deg,#0f2027,#203a43,#2c5364,#1c92d2);background-size:600% 600%;animation:bgMove 12s ease infinite;color:#fff;text-align:center}
    @keyframes bgMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    h1{margin:18px 0}
    .container{display:flex;justify-content:center;flex-wrap:wrap;gap:28px;margin-top:20px}
    .card{position:relative;width:260px;height:200px;border-radius:18px;background:var(--card-bg);backdrop-filter:blur(14px);box-shadow:0 8px 30px rgba(0,0,0,0.25);overflow:hidden;transition:.35s}
    .card:hover{transform:translateY(-10px) scale(1.03);box-shadow:0 10px 40px rgba(0,255,255,0.12)}
    .card h3{margin:12px 0 0}
    .value{font-size:40px;font-weight:700;z-index:2;position:relative;margin-top:6px}
    .fire,.water{position:absolute;left:50%;transform:translateX(-50%);bottom:0}
    .fire{width:120px;height:120px}
    .water{width:100%;height:36%;background:linear-gradient(180deg,var(--accent2),#0072ff)}
    .chart-box{width:460px;max-width:95%;margin:24px auto;background:var(--card-bg);border-radius:16px;padding:16px;backdrop-filter:blur(12px);box-shadow:0 8px 28px rgba(0,0,0,0.18)}
    canvas{filter:drop-shadow(0 0 12px rgba(0,0,0,0.15))}
    .status{margin:14px;font-size:14px;opacity:.95}
  </style>
</head>
<body>
  <h1>ðŸŒ¡ Smart IoT Weather Dashboard</h1>

  <div class="container">
    <div class="card">
      <h3>Temperature</h3>
      <div id="temp" class="value">-- Â°C</div>
      <div class="fire" id="fire">
        <!-- visual flame placeholder -->
      </div>
    </div>

    <div class="card">
      <h3>Humidity</h3>
      <div id="hum" class="value">-- %</div>
      <div class="water" id="water"></div>
    </div>
  </div>

  <div class="chart-box"><canvas id="barChart"></canvas></div>
  <div class="chart-box"><canvas id="pieChart"></canvas></div>
  <div class="chart-box"><canvas id="lineChart"></canvas></div>

  <div class="status" id="status">Status: Idle</div>

  <script>
    const url = "https://api.thingspeak.com/channels/3272831/feeds.json?api_key=ZLLHL9EPP9OWJNV0&results=20";

    let tempHistory = [], humHistory = [], labels = [];

    const barChart = new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: { labels: ['Temperature','Humidity'], datasets: [{ data:[0,0], backgroundColor: ['#ff512f','#00c6ff'], borderRadius:8 }] },
      options: { plugins:{legend:{display:false}}, animation:{duration:800} }
    });

    const pieChart = new Chart(document.getElementById('pieChart'), {
      type: 'doughnut',
      data: { labels:['Temperature','Humidity'], datasets:[{ data:[0,0], backgroundColor:['#ff512f','#00c6ff'] }] },
      options: { cutout: '60%' }
    });

    const lineChart = new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: { labels: labels, datasets: [
        { label: 'Temperature', data: tempHistory, borderColor: '#ff512f', backgroundColor: 'rgba(255,81,47,0.12)', fill:true, tension:0.35 },
        { label: 'Humidity', data: humHistory, borderColor: '#00c6ff', fill:false, tension:0.35 }
      ] },
      options: { animation:{duration:600}, scales:{y:{beginAtZero:true}} }
    });

    function animateValue(id, value, unit) {
      const el = document.getElementById(id);
      const start = parseFloat(el.dataset.current || '0');
      const duration = 600;
      const startTime = performance.now();
      function frame(now){
        const t = Math.min((now - startTime)/duration,1);
        const cur = start + (value - start) * t;
        el.innerText = cur.toFixed(1) + ' ' + unit;
        if(t < 1) requestAnimationFrame(frame); else el.dataset.current = value;
      }
      requestAnimationFrame(frame);
    }

    async function fetchData(){
      const status = document.getElementById('status');
      try{
        status.innerText = 'Status: Fetching...';
        const res = await fetch(url);
        if(!res.ok){ status.innerText = 'Status: HTTP ' + res.status; return; }
        const data = await res.json();
        const feeds = data.feeds || [];
        if(feeds.length === 0){ status.innerText = 'Status: no feed data'; return; }

        // build arrays from feeds (oldest->newest)
        labels = feeds.map(f => new Date(f.created_at).toLocaleTimeString());
        tempHistory = feeds.map(f => parseFloat(f.field1) || 0);
        humHistory = feeds.map(f => parseFloat(f.field2) || 0);

        const latest = feeds[feeds.length-1];
        const temp = parseFloat(latest.field1) || 0;
        const hum = parseFloat(latest.field2) || 0;

        animateValue('temp', temp, 'Â°C');
        animateValue('hum', hum, '%');

        // visual elements
        document.getElementById('fire').style.transform = `translateX(-50%) scale(${1 + temp/50})`;
        document.getElementById('water').style.height = hum + '%';

        // charts
        barChart.data.datasets[0].data = [temp, hum];
        barChart.update();

        pieChart.data.datasets[0].data = [temp, hum];
        pieChart.update();

        lineChart.data.labels = labels;
        lineChart.data.datasets[0].data = tempHistory;
        lineChart.data.datasets[1].data = humHistory;
        lineChart.update();

        status.innerText = 'Status: Updated âœ”';
      } catch(err){
        console.error(err);
        document.getElementById('status').innerText = 'Status: Error (see console)';
      }
    }

    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>
